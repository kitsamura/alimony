$(document).ready(function() {
    $('#questionTel').mask("7 999 999 9999");

    $('.form__btn').click(async (e) => {
        if (($('[name="sale[tel]"]').val().length > 1) && ($('[name="sale[name]"]').val().length > 0) && ($('#check_hidden').is(':checked'))) {
            e.preventDefault();
            $('.form__btn').css({'opacity':'0.4', 'cursor':'no-drop'});
            $('.form__btn').attr("disabled", "disabled");
            const fd = new FormData();
            fd.append('phone', $('[name="sale[tel]"]').val());
            fd.append('email', $('[name="sale[email]"]').val());
            fd.append('name', $('[name="sale[name]"]').val());
            fd.append('href', window.location.href);
            const url = `./ajax/mail.php`
            const config = {
                method: 'POST',
                body: fd
            };
            await fetch(url, config);
            
            setTimeout(function() {
                $('.question__form').hide();
                $('.question__title').text('Ваша заявка принята');
                $('.question__main').css('padding-bottom', '183px');
                $('.question__priceBlock').css('background', '#C3E4B3');
            }, 400)
        }
    });



    $(document).on('keyup', '.input__mail', function() {
        let email = $(this).val();
        if (email.length > 0 &&
            (email.match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/))) {
            $(this).removeClass('invalid');
        } else if (email.length == 0) {
            $(this).addClass('invalid');
        } else {
            $(this).addClass('invalid');
        }
    });

    //video
    $(".video__btn").click(function(e) {
        e.preventDefault(),
            ym(42964584, "reachGoal", "alimenty-video"),
            $(this).css("display", "none"),
            $(".video__hideBlock").fadeIn()
    });

    // -----аккордеон-----
    $('.toggler__title, .toggler__check').click(function() {
        $(this).parent().toggleClass('toggler__item_active')
        $(this).parent().find('.toggler__content').slideToggle()
    })
    $('.scroll__form').click(function() {
        let el = $(this);
        let dest = el.attr('href');
        if (dest !== undefined && dest !== '') {
            $('html').animate({
                scrollTop: $(dest).offset().top
            }, 700);
        }
        return false;
    });

    $(window).scroll(function() {
        if ($(this).scrollTop() != 0) {
            $('.top__btn').fadeIn()
        } else {
            $('.top__btn').fadeOut()
        }
    });
    $('.top__btn').click(function() {
        $('body,html').animate({
            scrollTop: 0
        }, 800)
    });

});